<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Websocket Tests</title>
	<meta name="description" content="Websocket Tests">
	<meta name="author" content="Tomasz Piwowarski & Emil Dworniczak">
	<meta property="og:title" content="Websocket Tests">
	<meta property="og:type" content="website">
	<meta property="og:description" content="Websocket Tests">
	<meta property="og:image" content="image.png">

	<!--  <link rel="icon" href="/favicon.ico">
	  <link rel="apple-touch-icon" href="/apple-touch-icon.png">-->

</head>

<body>
<script>
	let inCount = 0;
	let timestart = 0;
	let endtime = 0;
    const address = 'ws://localhost:83';
    const message = 'SqlWS';
    console.log("address: ", address);
	let socket = new WebSocket(address);
	socket.onopen = function (e) {
		timestart = Date.now();
		console.log("[open] Connection established");
		console.log("Sending to server");
        socket.send(message);
	};
	socket.onmessage = function (event) {
		// console.log(`[message] Data received from server: ${event.data}`);
		++inCount;
        endtime = Date.now();
        let time = endtime - timestart;
		if (time >= 30000) {
			console.log(timestart, " : ", endtime, " = ", time);
            console.log("queries served: ", inCount);
            return;
		}
        socket.send(message);
	};
	socket.onclose = function (event) {
		if (event.wasClean) {
			console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
		} else {
			console.log('[close] Connection died');
		}
	};
	socket.onerror = function (error) {
		console.log(`[error] ${error.message}`);
	};
</script>
</body>
</html>
